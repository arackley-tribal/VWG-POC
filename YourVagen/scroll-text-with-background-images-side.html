<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <meta name="generator" content={Astro.generator} />
    <title>Document</title>
    <style>
        @font-face {
            font-family: 'vw-head';
            font-weight: 400;
            font-display: swap;
            src: url('https://www.volkswagen.co.uk/apps/clientlibs/vwa-ngw18/ngw18-frontend/clientlibs/statics/fonts/vwhead-regular.woff2') format('woff2'),
                url('https://www.volkswagen.co.uk/apps/clientlibs/vwa-ngw18/ngw18-frontend/clientlibs/statics/fonts/vwhead-regular.woff') format('woff');
        }

        @font-face {
            font-family: 'vw-head';
            font-weight: 700;
            font-display: swap;
            src: url('https://www.volkswagen.co.uk/apps/clientlibs/vwa-ngw18/ngw18-frontend/clientlibs/statics/fonts/vwhead-bold.woff2') format('woff2'),
                url('https://www.volkswagen.co.uk/apps/clientlibs/vwa-ngw18/ngw18-frontend/clientlibs/statics/fonts/vwhead-bold.woff') format('woff');
        }

        @font-face {
            font-family: 'vw-head';
            font-weight: 200;
            font-display: swap;
            src: url('https://www.volkswagen.co.uk/apps/clientlibs/vwa-ngw18/ngw18-frontend/clientlibs/statics/fonts/vwhead-light.woff2') format('woff2'),
                url('https://www.volkswagen.co.uk/apps/clientlibs/vwa-ngw18/ngw18-frontend/clientlibs/statics/fonts/vwhead-light.woff') format('woff');
        }

        * {
            box-sizing: border-box;
        }

        body {
            background: #111;
            min-height: 100vh;
            padding: 0;
            margin: 0;
        }

        .main-image {
            width: 100%;
            height: 100vh;
            overflow: hidden;
            background-size: cover;
            display: none;
            transition: background 0.5s ease-in;
            z-index: 0;
        }

        .gallery {
            width: 100%;
            height: 100vh;
            overflow: hidden;
            position: relative;
        }

        .images {
            position: absolute;
            width: 50%;
            height: 100vh;
            overflow: hidden;
            border: 2px solid pink;
        }

        .cards {
            position: absolute;
            width: 50%;
            height: 5rem;
            top: 50%;
            left: 0%;
            transform: translate(0%, -50%);
            text-align: right;
            border: 3px solid red;
        }

        .cards li {
            font-family: 'vw-head';
            font-weight: 500;
            list-style: none;
            padding: 0;
            margin: 0;
            height: 5rem;
            line-height: 6rem;
            font-size: 10rem;
            font-family: sans-serif;
            position: absolute;
            top: 0;
            right: 0;
            border-radius: 0.8rem;
            color: black;
            z-index: 100;
        }

        .stickyCard {
            font-family: 'vw-head';
            font-weight: 700;
            position: absolute;
            top: 40%;
            left: 103% !important;
            padding: 0;
            margin: 0;
            width: 14rem;
            height: 5rem;
            line-height: 6rem;
            font-size: 10rem;
            font-family: sans-serif;
            text-align: left;
            position: absolute;
            top: 0;
            left: 0;
            border-radius: 0.8rem;
            color: black;
            font-weight: bold;
            z-index: 100;
        }

        .intersection {
            height: 5rem;
        }

        #video {
            display: none;
        }
    </style>
    <script src="https://unpkg.co/gsap@3/dist/gsap.min.js"></script>
    <script src="https://unpkg.com/gsap@3/dist/ScrollTrigger.min.js"></script>
</head>

<body>

    <div id="gallery" class="gallery">
        <video id="video" autoplay muted>
            <source src="./vw-car.mp4" type="video/mp4">
        </video>
        <ul class="cards">
            <li id="1">your</li>
            <li id="2">aarons</li>
            <li id="3">hello</li>
            <li id="4">maybe</li>
            <li id="5">something</li>
            <li id="6">random</li>
            <li id="7">future</li>
            <li id="8">world</li>
            <li id="9">system</li>
            <li id="10">banana</li>
            <div class="intersection"></div>
            <div class="stickyCard">wagen</div>
        </ul>
        <div id="images">
            asdoskd
        </div>
    </div>


    <script>

        const images = [
            "https://images.unsplash.com/photo-1502352981868-f957ab3e10eb?w=500&auto=format&fit=crop&q=60&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8Nnx8dnclMjBjYXJzfGVufDB8fDB8fHww",
            "https://images.unsplash.com/photo-1510360638044-c6f328b5d283?w=500&auto=format&fit=crop&q=60&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8OXx8dnclMjBjYXJzfGVufDB8fDB8fHww",
            "https://images.unsplash.com/photo-1477852602855-d50ec886d299?w=500&auto=format&fit=crop&q=60&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8MTJ8fHZ3JTIwY2Fyc3xlbnwwfHwwfHx8MA%3D%3D",
            "https://images.unsplash.com/photo-1469854523086-cc02fe5d8800?w=500&auto=format&fit=crop&q=60&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8MTN8fHZ3JTIwY2Fyc3xlbnwwfHwwfHx8MA%3D%3D",
            "https://images.unsplash.com/photo-1464219789935-c2d9d9aba644?w=500&auto=format&fit=crop&q=60&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8MTd8fHZ3JTIwY2Fyc3xlbnwwfHwwfHx8MA%3D%3D",
            "https://images.unsplash.com/photo-1496150411361-89024c1add8c?w=500&auto=format&fit=crop&q=60&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8MjB8fHZ3JTIwY2Fyc3xlbnwwfHwwfHx8MA%3D%3D",
            "https://images.unsplash.com/photo-1502352981868-f957ab3e10eb?w=500&auto=format&fit=crop&q=60&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8Nnx8dnclMjBjYXJzfGVufDB8fDB8fHww",
            "https://images.unsplash.com/photo-1510360638044-c6f328b5d283?w=500&auto=format&fit=crop&q=60&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8OXx8dnclMjBjYXJzfGVufDB8fDB8fHww",
            "https://images.unsplash.com/photo-1477852602855-d50ec886d299?w=500&auto=format&fit=crop&q=60&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8MTJ8fHZ3JTIwY2Fyc3xlbnwwfHwwfHx8MA%3D%3D",
            "https://images.unsplash.com/photo-1469854523086-cc02fe5d8800?w=500&auto=format&fit=crop&q=60&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8MTN8fHZ3JTIwY2Fyc3xlbnwwfHwwfHx8MA%3D%3D",
            "https://images.unsplash.com/photo-1464219789935-c2d9d9aba644?w=500&auto=format&fit=crop&q=60&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8MTd8fHZ3JTIwY2Fyc3xlbnwwfHwwfHx8MA%3D%3D",
            "https://images.unsplash.com/photo-1496150411361-89024c1add8c?w=500&auto=format&fit=crop&q=60&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8MjB8fHZ3JTIwY2Fyc3xlbnwwfHwwfHx8MA%3D%3D",
            "https://images.unsplash.com/photo-1502352981868-f957ab3e10eb?w=500&auto=format&fit=crop&q=60&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8Nnx8dnclMjBjYXJzfGVufDB8fDB8fHww",
            "https://images.unsplash.com/photo-1510360638044-c6f328b5d283?w=500&auto=format&fit=crop&q=60&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8OXx8dnclMjBjYXJzfGVufDB8fDB8fHww",
            "https://images.unsplash.com/photo-1477852602855-d50ec886d299?w=500&auto=format&fit=crop&q=60&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8MTJ8fHZ3JTIwY2Fyc3xlbnwwfHwwfHx8MA%3D%3D",
            "https://images.unsplash.com/photo-1469854523086-cc02fe5d8800?w=500&auto=format&fit=crop&q=60&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8MTN8fHZ3JTIwY2Fyc3xlbnwwfHwwfHx8MA%3D%3D",
            "https://images.unsplash.com/photo-1464219789935-c2d9d9aba644?w=500&auto=format&fit=crop&q=60&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8MTd8fHZ3JTIwY2Fyc3xlbnwwfHwwfHx8MA%3D%3D",
            "https://images.unsplash.com/photo-1496150411361-89024c1add8c?w=500&auto=format&fit=crop&q=60&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8MjB8fHZ3JTIwY2Fyc3xlbnwwfHwwfHx8MA%3D%3D"
        ]

        const gallery = document.getElementById('gallery')

        images.forEach((url, index) => {
            const newImageDiv = document.createElement('div');
            newImageDiv.classList.add('main-image');
            newImageDiv.style.backgroundImage = `url('${url}')`;
            let id = index + 1;
            newImageDiv.id = `image-${id}`;
            if (id = 1) {
                newImageDiv.style.display = "block"
            }
            gallery.appendChild(newImageDiv)
        })

        gsap.registerPlugin(ScrollTrigger);

        let iteration = 0; // gets iterated when we scroll all the way to the end or start and wraps around - allows us to smoothly continue the playhead scrubbing in the correct direction.
        let timeElapsed = null;
        let videoIsPlaying = false;

        const spacing = 0.25;  // spacing of the cards (stagger)
        const snap = gsap.utils.snap(spacing); // we'll use this to snap the playhead on the seamlessLoop
        const cards = gsap.utils.toArray('.cards li');
        const seamlessLoop = buildSeamlessLoop(cards, spacing);
        const scrub = gsap.to(seamlessLoop, { // we reuse this tween to smoothly scrub the playhead on the seamlessLoop
            totalTime: 0,
            duration: 0.5,
            ease: "power3",
            paused: true
        });
        const trigger = ScrollTrigger.create({
            start: 0,
            onUpdate(self) {
                if (self.progress === 1 && self.direction > 0 && !self.wrapping) {
                    wrapForward(self);
                } else if (self.progress < 1e-5 && self.direction < 0 && !self.wrapping) {
                    wrapBackward(self);
                } else {
                    scrub.vars.totalTime = snap((iteration + self.progress) * seamlessLoop.duration());
                    scrub.invalidate().restart(); // to improve performance, we just invalidate and restart the same tween. No need for overwrites or creating a new tween on each update.
                    self.wrapping = false;
                }
                var intersection = document.querySelector(".intersection");
                var rectSelection = intersection.getBoundingClientRect();

                // Iterate over all LI elements.
                [].forEach.call(document.querySelectorAll("li"), function (li) {
                    const rect = li.getBoundingClientRect();
                    const id = `image-${li.id}`;
                    const domEl = document.getElementById(id);

                    if (rect.bottom > rectSelection.top
                        && rect.right > rectSelection.left
                        && rect.top < rectSelection.bottom
                        && rect.left < rectSelection.right) {
                        if (domEl.style.display === "none") {
                            domEl.style.display = "block"
                            timeElapsed = new Date();
                            const video = document.getElementById('video');
                            video.style.display = "none";
                        }
                    } else {
                        domEl.style.display = "none"
                    }
                });
            },
            end: `+=600`,
            pin: ".gallery"
        });

        function checkIfVideoShouldShow() {
            if (!videoIsPlaying) {
                console.log('checking video')
                const video = document.getElementById('video');
                if (!video.style.display == "block") return
                let visible = false;
                if (timeElapsed) {
                    let endTime = new Date();
                    var timeDiff = endTime - timeElapsed; //in ms
                    var seconds = Math.round(timeDiff / 1000);
                    if (seconds > 1) {
                        video.style.display = "block";
                        video.play()
                        videoIsPlaying = true;
                    }
                }
            }
        }

        setInterval(checkIfVideoShouldShow, 1000);

        function wrapForward(trigger) { // when the ScrollTrigger reaches the end, loop back to the beginning seamlessly
            iteration++;
            trigger.wrapping = true;
            trigger.scroll(trigger.start + 1);
        }

        function wrapBackward(trigger) { // when the ScrollTrigger reaches the start again (in reverse), loop back to the end seamlessly
            iteration--;
            if (iteration < 0) { // to keep the playhead from stopping at the beginning, we jump ahead 10 iterations
                iteration = 9;
                seamlessLoop.totalTime(seamlessLoop.totalTime() + seamlessLoop.duration() * 10);
                scrub.pause(); // otherwise it may update the totalTime right before the trigger updates, making the starting value different than what we just set above. 
            }
            trigger.wrapping = true;
            trigger.scroll(trigger.end - 1);
        }

        function buildSeamlessLoop(items, spacing) {
            let overlap = Math.ceil(1 / spacing), // number of EXTRA animations on either side of the start/end to accommodate the seamless looping
                startTime = items.length * spacing + 0.5, // the time on the rawSequence at which we'll start the seamless loop
                loopTime = (items.length + overlap) * spacing + 1, // the spot at the end where we loop back to the startTime 
                rawSequence = gsap.timeline({ paused: true }), // this is where all the "real" animations live
                seamlessLoop = gsap.timeline({ // this merely scrubs the playhead of the rawSequence so that it appears to seamlessly loop
                    paused: true,
                    repeat: -1, // to accommodate infinite scrolling/looping
                    onRepeat() { // works around a super rare edge case bug that's fixed GSAP 3.6.1
                        this._time === this._dur && (this._tTime += this._dur - 0.01);
                    }
                }),
                l = items.length + overlap * 2,
                time = 0,
                i, index, item;

            // set initial state of items
            gsap.set(items, { opacity: 0, scale: 0 });

            // now loop through and create all the animations in a staggered fashion. Remember, we must create EXTRA animations at the end to accommodate the seamless looping.
            for (i = 0; i < l; i++) {
                index = i % items.length;
                item = items[index];
                time = i * spacing;
                rawSequence.fromTo(item,
                    { scale: 1, opacity: 0 },
                    { scale: 1, opacity: 1, zIndex: 100, duration: 0.5, yoyo: true, repeat: 1, ease: "power1.in", immediateRender: false }, time)
                    .fromTo(item, { yPercent: 400 }, { yPercent: -400, duration: 1, ease: "none", immediateRender: false }, time);
                i <= items.length && seamlessLoop.add("label" + i, time); // we don't really need these, but if you wanted to jump to key spots using labels, here ya go.
            }

            // here's where we set up the scrubbing of the playhead to make it appear seamless. 
            rawSequence.time(startTime);
            seamlessLoop.to(rawSequence, {
                time: loopTime,
                duration: loopTime - startTime,
                ease: "none"
            }).fromTo(rawSequence, { time: overlap * spacing + 1 }, {
                time: startTime,
                duration: startTime - (overlap * spacing + 1),
                immediateRender: false,
                ease: "none"
            });
            return seamlessLoop;
        }

    </script>

</body>

</html>